#!name= All In One Personal Apple Full
#!desc= Appleå…¨åŠŸèƒ½è§£é–ğŸ”“é›†åˆSgmodule

[Script]
# ä¿®æ”¹å®šä½æœå‹™(Location Services)é…ç½®æ–‡ä»¶(Configs)å’ŒGCC(Geo Country Code)æª¢æ¸¬çµæœ
# Response Location Services Geo Country Code Check Result to US
Location_Services.beta = type=http-request,pattern=^https?:\/\/gspe\d*-ssl\.ls\.apple\.com(\/pep\/gcc), requires-body=0, binary-body-mode=0, max-size=0, script-update-interval=0, argument=GeoCountryCode=US, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
# Rewrite Location Services Configuration Functions Internationalization
Location_Services.beta = type=http-request,pattern=^https?:\/\/configuration\.ls\.apple\.com(\/config\/defaults\?).*, requires-body=0, binary-body-mode=0, max-size=0 ,script-update-interval=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
Location_Services.beta = type=http-response,pattern=^https?:\/\/configuration\.ls\.apple\.com(\/config\/defaults\?).*, requires-body=1, binary-body-mode=0, max-size=0 ,script-update-interval=0, argument=EnableAlberta=false&GEOAddressCorrectionEnabled=true&LocalitiesAndLandmarksSupported=true&PedestrianAREnabled=true&ShouldEnableLagunaBeach=true, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js
# Rewrite AutoNavi Dispatcher from com.apple.compass
Location_Services.beta = type=http-request,pattern=^https?:\/\/dispatcher\.is\.autonavi\.com(\/dispatcher), requires-body=1, binary-body-mode=1, max-size=0 ,script-update-interval=0, script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/beta/js/Location_Services.beta.js

# åœ¨èšç„¦æœç´¢(Spotlight)å’ŒæŸ¥è©¢(Look Up)ä¸­å•“ç”¨Siriå»ºè­°(Siri Suggestions)åŠŸèƒ½
# Redirect Siri Suggestions Service 
# Bag (iOS/macOS)
http-request ^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/bag\?(.*) script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri_Suggestions.js, timeout=3, tag=Siri_Suggestions
# Spotlight & Look Up Search (iOS/macOS)
http-request ^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/search\?(.*) script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri_Suggestions.js, timeout=3, tag=Siri_Suggestions
# Siri Infomation Card (macOS)
http-request ^https?:\/\/api.*\.smoot\.apple\.(com|cn)\/card\?(.*) script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Siri_Suggestions.js, timeout=3, tag=Siri_Suggestions

# è§£é–ï£¿TV appå…¨åŠŸèƒ½ï¼šä½¿ç”¨ğŸ‡ºğŸ‡¸USã€Œé«”è‚²ç¯€ç›®ã€å’Œã€Œå…’ç«¥ã€é é¢
# Enable All ï£¿TV app Tabs
http-response ^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/configurations\?.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, requires-body=true, timeout=3, tag=Apple_TV
# ï£¿TV app Tabs, Redirect Desktop Platform to AppleTV, Redirect Sports and Kids Tabs StoreFront to US (143441)
http-request ^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/canvases\/Roots\/(watchNow|tahoma_watchnow|movies|tv|sports|kids)\?.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV app movies and shows and sports infomation Webs, Redirect Desktop Platform to AppleTV
http-request ^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/(movies|shows|sports|sporting-events).* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV UpNext, Redirect Desktop Platform to AppleTV
http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/shelves\/uts.col.UpNext.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV channels, Redirect StoreFront to US (143441)
http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/brands\?.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV Live Playables, Redirect StoreFront to US (143441)
http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/playables.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV Favorites Teams web, Redirect StoreFront to US (143441)
http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/favorites\?.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# ï£¿TV Watchlist Function, Redirect desktop Platform to iPad
http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/watchlist.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV
# Enable ï£¿TV Favorites Teams Function, Redirect StoreFront to US (143441)
http-request ^https?:\/\/uts-api\.itunes\.apple\.com\/uts\/(v1|v2|v3)\/favorites\/(add|remove).* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, requires-body=true, timeout=3, tag=Apple_TV
# ï£¿TV Product View, no Redirect
# http-request ^https?:\/\/uts-api\.itunes\.apple\.com(\/uts\/)(v1|v2|v3)\/view\/product\/.* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_TV.js, timeout=3, tag=Apple_TV

# è§£é–ğŸ‡ºğŸ‡¸USåœ°å€çš„ï£¿Newsï¼Œæ³¨ï¼šéœ€é…åˆåŸŸåé›†ä½¿ç”¨ï¼Œä½¿ç”¨éç¨‹ä¸­gateway.icloud.coméœ€èµ°ä»£ç†ç·šè·¯
http-request ^https?:\/\/news-(edge|events)\.apple\.com\/(v1\/configs|analyticseventsv2\/async).* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js, requires-body=true, tag=Apple_News
http-request ^https?:\/\/news-(client-search)\.apple\.com\/(v1\/search\?).* script-path=https://raw.githubusercontent.com/VirgilClyne/iRingo/main/js/Apple_News.js, tag=Apple_News

[URL Rewrite]
# åˆ‡æ›ç©ºæ°£è³ªé‡åœ°åœ–æ•¸æ“šæºç‚ºwaqi.infoï¼Œä¸¦æ›´æ”¹æ¨™æº–ç‚ºAQI(US)
# Rewrite Apple Weather Air Quality Map
^https?:\/\/weather-map\.apple\.com\/(v1|v2)\/mapOverlay\/airQuality\?x=(-?\d+)&y=(-?\d+)&z=(-?\d+).*(country=CN)?.* https://tiles.waqi.info/tiles/usepa-aqi/$4/$2/$3.png?&scale=2&country=US&colorFormat=agr header

# åªä½œç”¨æ–¼Apple Mapsï¼Œä¸ä¿®æ”¹å®šä½æœå‹™å’Œåœ°å€æª¢æ¸¬ï¼Œå¯ä»¥é€šéæ­é…ä½¿ç”¨å…¶ä»–æ¨¡å¡Šé”æˆæ··åˆæ•ˆæœ
# Redirect Apple Maps to US
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(country_code=[A-Z]{2})(.*) $1$2$3country_code=US$5 header
(^https?:\/\/gspe\d*-ssl\.ls\.apple\.)(com|cn)(\/.*)(environment=[a-z/-]{4,})(.*) $1$2$3environment=prod$5 header

[MITM]
hostname = %APPEND% news-client.apple.com, news-client-search.apple.com, news-edge.apple.com, news-events.apple.com, uts-api.itunes.apple.com, gspe35-ssl.ls.apple.com, weather-map.apple.com, tiles.waqi.info, configuration.ls.apple.com, gspe1-ssl.ls.apple.com, dispatcher.is.autonavi.com, -cdn*.smoot.apple.com, -fbs.smoot.apple.com, *.smoot.apple.com, *.smoot.apple.cn
